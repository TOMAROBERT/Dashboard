<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/highcharts-more.js"></script>
  <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>
  <script src="https://kit.fontawesome.com/1742c7f68a.js" crossorigin="anonymous"></script>

  <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
      crossorigin="anonymous"
    />
  <link rel="stylesheet" href="styles.css" />
  <title>Panou de control</title>
    

</head>
    
<body id="body">
    <div class="container">
      <nav class="navbar">
        <div class="navbar__left">
          <a href="#">TAB1</a>
          <a href="#">TAB2</a>
          <a class="active_link" href="#">Admin</a>
        </div>
        <div class="navbar__right">
          <a href="#">
            <img width="30" src="assets/avatar.svg" alt="" />
            <!-- <i class="fa fa-user-circle-o" aria-hidden="true"></i> -->
          </a>
        </div>
      </nav>

      <main>
        <div class="container_principal">
          <!-- Titlu -->

          <div class="container_titlu">
            <img src="https://www.hants.gov.uk/-/media/campaigns/CCBS---staying-safe/wash-hands-logo-no-title-500x500.png" alt="" />
              
            <div class="container_mesaj">
              <h1>Bine ai venit !</h1>
              <p>Meniul principal</p>
            </div>
          </div>
            

          <!-- END titlu -->

          <!-- Cuprins/Card-uri 1-->
          <div class="card_principal cp_1">
            <div class="card">
              <i
                class="fa fa-exchange fa-2x text-green"
                aria-hidden="true"
              ></i>
              <p class="text-primary-p">Senzor ultrasonic HR-S04</p>
              <div class="card_continut">
                  <div id="container1">
                    <figure class="highcharts-figure">
                        <div id="containerUltra"></div>
                    </figure> 
                  </div>
              </div>
            </div>

            <div class="card">
              <i class="fa fa-tint fa-2x text-lightblue" aria-hidden="true"></i>
              <p class="text-primary-p">Senzor nivel lichid</p>
              <div class="card_continut">  
                  
                  <div id="container2">
                    <div id="chart2">
                     <figure class="highcharts-figure">
                            <div id="container-speed" class="chart-container"></div>
                            <div id="container-rpm" class="chart-container"></div>
                     </figure> 
                    </div>
                  </div>
              </div>
            </div>
          </div>
          <!-- END cuprins/card-uri 1-->
            
          <!-- Cuprins/Card-uri 2-->
          <div class="card_principal cp_1">
            <div class="card">
              <i
                class="fa fa-thermometer-half fa-2x text-green"
                aria-hidden="true"
              ></i>
              <p class="text-primary-p">Senzor Temperatura D8B20</p>
              <div class="card_continut">
                  <div id="container3">
                    <figure class="highcharts-figure">
                        <div id="containerTemp"></div>
                    </figure> 
                  </div>                  
                  
              </div>
            </div>

            <div class="card">
                <ul>
                  <li><i class="fas fa-hands-wash" style="color: #DEB887;"></i><h1><p class="text-valori-directe" id="listaDistanta"></p><p class="text-unitati">cm</p></h1></li>
                  <li><i class="fas fa-water" style="color: cornflowerblue;"></i><h1><p class="text-valori-directe" id="listaNivel"></p><p class="text-unitati">ml</p></h1></li>
                  <li><i class="fas fa-thermometer" style="color: #4682B4;"></i><h1><p class="text-valori-directe" id="listaTemperatura"></p><p class="text-unitati">&#8451</p></h1></li>
                </ul>
                <ul>
                <button class="buttonSW"><a href="/on">ON</a></button>
                <button class="buttonSW buttonRosu"><a href="/off">OFF</a></button>                  
                </ul>
            </div>
          </div>
          <!-- END cuprins/card-uri 2-->
        </div>         
      </main>
    </div>
  </body>
    
    
<!--
    <figure class="highcharts-figure">
        <div id="containerUltra"></div>
    </figure> 
-->
    
<!--
    <figure class="highcharts-figure">
            <div id="container-speed" class="chart-container"></div>
            <div id="container-rpm" class="chart-container"></div>
    </figure>
-->
<!--
    <h2>Senzorul v1 are distanta :</h2><h2><div id="frumos1"></div></h2>    
    <h2>Senzorul are nivelul :</h2><h2><div id="frumos2"></div></h2>    
    <h2>Senzorul are temperatura apei:</h2><h2><div id="frumos3"></div></h2>
    <button onclick="location.href='http://localhost:81/dashboard/test/Login.php'">Log Out</button>
-->

    
    
    
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase.js"></script>    
<script>   
const firebaseConfig = {
  apiKey: "AIzaSyAZjEKxN9ZnOgDJRItNV36t9xMyl7sceLE",
  authDomain: "self-hands-washing.firebaseapp.com",
  databaseURL: "https://self-hands-washing-default-rtdb.firebaseio.com",
  projectId: "self-hands-washing",
  storageBucket: "self-hands-washing.appspot.com",
  messagingSenderId: "961080730162",
  appId: "1:961080730162:web:f7b45fed98efb1250d922b",
  measurementId: "G-272TDJEF64"
};  
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();
    
// GET in modul clasic
//setInterval(function ( ) {
//  var xhttp1 = new XMLHttpRequest();
//  xhttp1.onreadystatechange = function() {
//    if (this.readyState == 4 && this.status == 200) {
//        firebase.database().ref("ValoriLicenta").set({
//            ultrasonic:document.getElementById("frumos1").innerHTML = this.response
//        });
//        document.getElementById("frumos1").innerHTML = this.responseText;
//    }
//  };
//  xhttp1.open("GET", "/distanta", true);
//  xhttp1.send();
//    
//  var xhttp2 = new XMLHttpRequest();
//  xhttp2.onreadystatechange = function() {
//    if (this.readyState == 4 && this.status == 200) {
//      document.getElementById("frumos2").innerHTML = this.responseText;
//    }
//  };
//  xhttp2.open("GET", "/nivel", true);
//  xhttp2.send();
//    
//  var xhttp3 = new XMLHttpRequest();
//  xhttp3.onreadystatechange = function() {
//    if (this.readyState == 4 && this.status == 200) {
//      firebase.database().ref("ValoriLicenta").set({
//        temperatura:document.getElementById("frumos3").innerHTML = this.response
//      });
//      document.getElementById("frumos3").innerHTML = this.responseText;
//    }
//  };
//  xhttp3.open("GET", "/temperatura", true);
//  xhttp3.send();    
//}, 2000 ) ;  


// GET ultrasonic GRAFIC
Highcharts.chart('containerUltra', {
  chart: {
    type: 'spline',
    animation: Highcharts.svg,
    events: {
      load: function () {

        // actualizare grafic la fiecare Xsec
        var series = this.series[0];
        setInterval(function () {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  var x = (new Date()).getTime(),
                      y = parseFloat(this.responseText);

//                  console.log(this.responseText);
                  var newVal2 = parseInt(this.response);
                  document.getElementById("listaDistanta").innerHTML = newVal2;
                  series.addPoint([x, y], true, true);
                  
                } 
              };
              xhttp.open("GET", "/distanta", true);
              xhttp.send();
        }, 2000);
      }
    }
  },

  time: {
    useUTC: false 
  },

  title: {
    text: 'Distanta'
  },

  xAxis: {
    type: 'datetime',
    tickPixelInterval: 150
  },
    
  credits: {
    enabled: false
  },

  yAxis: {
    title: {
      text: 'Valori senzori'
    },
    plotLines: [{
      value: 0,
      width: 2,
      color: 'green'
    }]
  },

  tooltip: {
    headerFormat: '<b>Preluare la:</b><br/>',
    pointFormat: '{point.x:%Y-%m-%d %H:%M:%S}<br/>,valoare:{point.y:.2f}'
  },

  legend: {
    enabled: true
  },
    
  exporting: {
    enabled: false
  },

  series: [{
    name: 'Distanta senzor HC-SR04',
    data: (function () {
      // generate an array of random data
      var data = [],
        time = (new Date()).getTime(),
        i;
      for (i = 0; i <= 5; i += 1) {
        data.push({
          x: time + i * 1000
        });
      }
      return data;
    }())
  }]
});
//END ULTRASONIC GRAFIC
    
    
// GET temperatura GRAFIC
Highcharts.chart('containerTemp', {
  chart: {
    type: 'spline',
    animation: Highcharts.svg,
    events: {
      load: function () {

        // actualizare grafic la fiecare Xsec
        var series = this.series[0];
        setInterval(function () {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  var x = (new Date()).getTime(),
                      y = parseFloat(this.responseText);

//                  console.log(this.responseText);
                  var newVal2 = parseInt(this.response);
                  document.getElementById("listaTemperatura").innerHTML = newVal2;
                  series.addPoint([x, y], true, true);
                  
                } 
              };
              xhttp.open("GET", "/temperatura", true);
              xhttp.send();
        }, 2000);
      }
    }
  },

  time: {
    useUTC: false 
  },

  title: {
    text: 'Temperatura'
  },

  xAxis: {
    type: 'datetime',
    tickPixelInterval: 150
  },
    
  credits: {
    enabled: false
  },

  yAxis: {
    title: {
      text: 'Valori senzori'
    },
    plotLines: [{
      value: 0,
      width: 2,
      color: 'red'
    }]
  },

  tooltip: {
    headerFormat: '<b>Preluare la:</b><br/>',
    pointFormat: '{point.x:%Y-%m-%d %H:%M:%S}<br/>,valoare:{point.y:.2f}'
  },

  legend: {
    enabled: true
  },
    
  exporting: {
    enabled: false
  },

  series: [{
    name: 'Temperatura senzor DS18B20',
    data: (function () {
      // generate an array of random data
      var data = [],
        time = (new Date()).getTime(),
        i;
      for (i = 0; i <= 5; i += 1) {
        data.push({
          x: time + i * 1000
        });
      }
      return data;
    }())
  }]
});
//END temperatura GRAFIC    

    
    
    
    
// GET nivel INDICATOR
var gaugeOptions = {
  chart: {
    type: 'solidgauge'
  },

  title: null,

  pane: {
    center: ['50%', '85%'],
    size: '140%',
    startAngle: -90,
    endAngle: 90,
    background: {
      backgroundColor:
        Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
      innerRadius: '60%',
      outerRadius: '100%',
      shape: 'arc'
    }
  },

  exporting: {
    enabled: false
  },

  tooltip: {
    enabled: false
  },

  // the value axis
  yAxis: {
    stops: [
      [0.1, '#55BF3B'], // green
      [0.5, '#DDDF0D'], // yellow
      [0.9, '#DF5353'] // red
    ],
    lineWidth: 0,
    tickWidth: 0,
    minorTickInterval: null,
    tickAmount: 2,
    title: {
      y: -70
    },
    labels: {
      y: 16
    }
  },

  plotOptions: {
    solidgauge: {
      dataLabels: {
        y: 5,
        borderWidth: 0,
        useHTML: true
      }
    }
  }
};

// The speed gauge
var chartSpeed = Highcharts.chart('container-speed', Highcharts.merge(gaugeOptions, {
  yAxis: {
    min: 0,
    max: 100
//    title: {
//      text: 'Nivel'
//    }
  },

  credits: {
    enabled: false
  },

  series: [{
    name: 'Nivel',
    data: [0],
    dataLabels: {
      format:
        '<div style="text-align:center">' +
        '<span style="font-size:25px">{y}</span>ml<br/>' +
        '<span style="font-size:12px;opacity:0.4">Gel dezinfectant</span>' +
        '</div>'
    },
    tooltip: {
      valueSuffix: ' °C'
    }
  }]

}));

// Bring life to the dials
setInterval(function () {
  var point,
    newVal,
    inc;

  if (chartSpeed) {
    point = chartSpeed.series[0].points[0];
    newVal = 23;
    point.update(newVal);
  }
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  var point,
                    newVal,
                    inc;

                  if (chartSpeed) {
                    point = chartSpeed.series[0].points[0];
                    newVal = parseFloat(this.responseText);
//                    console.log(this.responseText);
                    point.update(newVal);
                      
                    var newVal2 = parseInt(this.response);
                    document.getElementById("listaNivel").innerHTML = newVal2;
                  }
                    
                } 
              };
              xhttp.open("GET", "/nivel", true);
              xhttp.send();
}, 2000);  
setInterval(function () {
    var oraData = new Date();
    var ziua = String(oraData.getDate()).padStart(2, '0');
    var luna = String(oraData.getMonth() + 1).padStart(2, '0'); //January is 0!
    var anul = oraData.getFullYear();
    var secunde = oraData.getSeconds();
    var minute = oraData.getMinutes();
    var ora = oraData.getHours();

    oraData = luna + '/' + ziua + '/' + anul + ' ** ' + ora + ':' + minute + ':' + secunde;

    var ultra = document.getElementById('listaDistanta').innerHTML;
    var nivel = document.getElementById('listaNivel').innerHTML;
    var temp  = document.getElementById('listaTemperatura').innerHTML;
//    console.log("distanta : " + ultra);
//    console.log("nivel : " + nivel);
//    console.log("temperatura : " + temp);
//    console.log("Ora si data sunt: " + oraData); 
    db.collection("ValoriLicentaStocate").doc().set({
        ultrasonic:ultra,
        nivel:nivel,
        temperatura:temp,
        data:oraData
    })
    .then(function(){
        console.log("Succes scris!");
    })
    .catch(function(){
        console.log("eroare"+eroare); 
    })
    
    firebase.database().ref("ValoriLicentaTimpReal").set({
        ultrasonic:ultra,
        nivel:nivel,
        temperatura:temp,
        data:oraData
    });
}, 2000); 
    
</script>
</html>
